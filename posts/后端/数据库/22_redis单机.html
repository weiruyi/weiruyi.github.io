<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.43" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/22_redis%E5%8D%95%E6%9C%BA.html"><meta property="og:site_name" content="Lance"><meta property="og:title" content="Redis单机"><meta property="og:description" content="Redis单机 一、数据库 1、实现 Redis服务器将所有数据库都保存在服务器状态redis.h/redisServer结构的db数组中，db数组的每个项都是一个redis.h/redisDb结构，每个redisDb结构代表一个数据库。数组长度（数据库数量）由dbnum控制，默认有16个，通过SELECT命令切换数据库。 RedisClient结构中..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-11-27T06:47:17.000Z"><meta property="article:author" content="RuyiWei"><meta property="article:published_time" content="2024-11-27T16:14:58.000Z"><meta property="article:modified_time" content="2024-11-27T06:47:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis单机","image":[""],"datePublished":"2024-11-27T16:14:58.000Z","dateModified":"2024-11-27T06:47:17.000Z","author":[{"@type":"Person","name":"RuyiWei"}]}</script><link rel="icon" href="/logo.png"><title>Redis单机 | Lance</title><meta name="description" content="Redis单机 一、数据库 1、实现 Redis服务器将所有数据库都保存在服务器状态redis.h/redisServer结构的db数组中，db数组的每个项都是一个redis.h/redisDb结构，每个redisDb结构代表一个数据库。数组长度（数据库数量）由dbnum控制，默认有16个，通过SELECT命令切换数据库。 RedisClient结构中...">
    <link rel="preload" href="/assets/style-CIdtaYfF.css" as="style"><link rel="stylesheet" href="/assets/style-CIdtaYfF.css">
    <link rel="modulepreload" href="/assets/app-_Le9TIJB.js"><link rel="modulepreload" href="/assets/22_redis单机.html-B8ybPys1.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DM3yQcKf.js" as="script"><link rel="prefetch" href="/assets/AliOSS.html-NuM4Ndio.js" as="script"><link rel="prefetch" href="/assets/Docker.html-BiSg4b_d.js" as="script"><link rel="prefetch" href="/assets/Git.html--On-x1vN.js" as="script"><link rel="prefetch" href="/assets/Markdown.html-B9x9zUvP.js" as="script"><link rel="prefetch" href="/assets/latexMath.html-BiiUdCWh.js" as="script"><link rel="prefetch" href="/assets/index.html-DEj2Buwf.js" as="script"><link rel="prefetch" href="/assets/10-分布式锁.html-CFtObAzh.js" as="script"><link rel="prefetch" href="/assets/2-字节码文件.html-B63aiatf.js" as="script"><link rel="prefetch" href="/assets/20_nio.html-Dbq1XbdU.js" as="script"><link rel="prefetch" href="/assets/21_Netty基础.html-DllyxaFp.js" as="script"><link rel="prefetch" href="/assets/22_Netty进阶.html-CdGhLnrJ.js" as="script"><link rel="prefetch" href="/assets/3-类加载器.html-BYVHpNgN.js" as="script"><link rel="prefetch" href="/assets/30_反射和动态代理.html-fYvu82U_.js" as="script"><link rel="prefetch" href="/assets/4_垃圾回收.html-cF11e2uE.js" as="script"><link rel="prefetch" href="/assets/index.html-CDNoO8oO.js" as="script"><link rel="prefetch" href="/assets/2_es基础.html-Lj9w21Fl.js" as="script"><link rel="prefetch" href="/assets/3_esDSL.html-DdqzGSJ2.js" as="script"><link rel="prefetch" href="/assets/4_elasticSearch与MySQL数据同步.html-2eksQVjg.js" as="script"><link rel="prefetch" href="/assets/5_ES集群.html-BABNFQif.js" as="script"><link rel="prefetch" href="/assets/index.html-DmyjtQPu.js" as="script"><link rel="prefetch" href="/assets/10_自动装配原理.html-CfKtw0Ww.js" as="script"><link rel="prefetch" href="/assets/11_springsecurity.html-DCYB2YQq.js" as="script"><link rel="prefetch" href="/assets/12_springsecurity2.html-Bb4YJT0K.js" as="script"><link rel="prefetch" href="/assets/9_事务.html-3d90DMOX.js" as="script"><link rel="prefetch" href="/assets/IOC.html-CidxEybi.js" as="script"><link rel="prefetch" href="/assets/index.html-xqN9lxno.js" as="script"><link rel="prefetch" href="/assets/SpringTask_7.html-C1YR9CX3.js" as="script"><link rel="prefetch" href="/assets/aop.html-DKmU-2T4.js" as="script"><link rel="prefetch" href="/assets/jwt.html-4UR2aMdm.js" as="script"><link rel="prefetch" href="/assets/websocket_8.html-B4yNvtS0.js" as="script"><link rel="prefetch" href="/assets/拦截器过滤器.html-BfXgHLMA.js" as="script"><link rel="prefetch" href="/assets/缓存.html-5Qb9LrBO.js" as="script"><link rel="prefetch" href="/assets/10_minio.html-qY23sfVT.js" as="script"><link rel="prefetch" href="/assets/11_xxl-job.html-B0jQT4C5.js" as="script"><link rel="prefetch" href="/assets/12_kafka.html-BP9xS_aW.js" as="script"><link rel="prefetch" href="/assets/6_服务保护.html-C8zJWkGp.js" as="script"><link rel="prefetch" href="/assets/7_分布式事务.html-BUcA5irC.js" as="script"><link rel="prefetch" href="/assets/8_MQ基础.html-DxGnvExU.js" as="script"><link rel="prefetch" href="/assets/9_MQ高级.html-B0reId12.js" as="script"><link rel="prefetch" href="/assets/index.html-VAmiouN7.js" as="script"><link rel="prefetch" href="/assets/服务注册与远程调用.html-BPtx6QwM.js" as="script"><link rel="prefetch" href="/assets/统一网关路由_4.html-DTxJIrBn.js" as="script"><link rel="prefetch" href="/assets/配置管理_5.html-DfJHPLLB.js" as="script"><link rel="prefetch" href="/assets/10_MyBatis.html-CV0XxLZD.js" as="script"><link rel="prefetch" href="/assets/11_MyBatisPlus.html-DvQe-v5a.js" as="script"><link rel="prefetch" href="/assets/15_MySQL高级1.html-DlTkemPf.js" as="script"><link rel="prefetch" href="/assets/16_mysql高级2.html-DENkhCXg.js" as="script"><link rel="prefetch" href="/assets/20_redis.html-B4Z5CyEC.js" as="script"><link rel="prefetch" href="/assets/21_redis数据结构.html-BklNXh4_.js" as="script"><link rel="prefetch" href="/assets/23_redis多机.html-JVti2MdA.js" as="script"><link rel="prefetch" href="/assets/24_redis独立功能.html-DzK21yr2.js" as="script"><link rel="prefetch" href="/assets/2_mysql主从同步.html-CZ_QC2Tz.js" as="script"><link rel="prefetch" href="/assets/3_读写分离.html-BD9U2wLu.js" as="script"><link rel="prefetch" href="/assets/4_canal.html-CR5ajOid.js" as="script"><link rel="prefetch" href="/assets/index.html-DUKUnPf9.js" as="script"><link rel="prefetch" href="/assets/index.html-BB-XgrxQ.js" as="script"><link rel="prefetch" href="/assets/汇编指令.html-Buf4YVBz.js" as="script"><link rel="prefetch" href="/assets/1_树.html-D2XPLEkr.js" as="script"><link rel="prefetch" href="/assets/2_图.html-BlxddjhR.js" as="script"><link rel="prefetch" href="/assets/index.html-hTpBd4R_.js" as="script"><link rel="prefetch" href="/assets/1_dlx舞蹈链.html-BSGpKRVH.js" as="script"><link rel="prefetch" href="/assets/2_A星算法.html-DcLg3Ufn.js" as="script"><link rel="prefetch" href="/assets/3_字符串匹配.html-Cd_9XzXR.js" as="script"><link rel="prefetch" href="/assets/index.html-D7CjaOCY.js" as="script"><link rel="prefetch" href="/assets/index.html-DoErwiLp.js" as="script"><link rel="prefetch" href="/assets/1_热文章计算.html-Dhzb8F6D.js" as="script"><link rel="prefetch" href="/assets/index.html-D7b1asws.js" as="script"><link rel="prefetch" href="/assets/index.html-CvJni3oh.js" as="script"><link rel="prefetch" href="/assets/竞价搜索.html-CjuwyFES.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ4-MBnq.js" as="script"><link rel="prefetch" href="/assets/3_认证授权.html--MeFjL4z.js" as="script"><link rel="prefetch" href="/assets/5_项目优化.html-DVzwfmuy.js" as="script"><link rel="prefetch" href="/assets/6_项目总结.html-D-kosLfP.js" as="script"><link rel="prefetch" href="/assets/index.html-CEnISTY4.js" as="script"><link rel="prefetch" href="/assets/404.html-C4jweezq.js" as="script"><link rel="prefetch" href="/assets/index.html-BU6I1GdQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BKoheGmd.js" as="script"><link rel="prefetch" href="/assets/index.html-BpuENFLt.js" as="script"><link rel="prefetch" href="/assets/index.html-C8wYyjrf.js" as="script"><link rel="prefetch" href="/assets/index.html-Ifg_ayLB.js" as="script"><link rel="prefetch" href="/assets/index.html-BfaqcSuG.js" as="script"><link rel="prefetch" href="/assets/index.html-DliUxOAs.js" as="script"><link rel="prefetch" href="/assets/index.html-B9RWGrad.js" as="script"><link rel="prefetch" href="/assets/index.html-DyT6UEBM.js" as="script"><link rel="prefetch" href="/assets/index.html-B1IjmfvF.js" as="script"><link rel="prefetch" href="/assets/index.html-BRsWC6x9.js" as="script"><link rel="prefetch" href="/assets/index.html-D8LIYnBw.js" as="script"><link rel="prefetch" href="/assets/index.html-Ccsl75zP.js" as="script"><link rel="prefetch" href="/assets/index.html-xpybO9g9.js" as="script"><link rel="prefetch" href="/assets/index.html-D1CXVnzK.js" as="script"><link rel="prefetch" href="/assets/index.html-CwCdXcH4.js" as="script"><link rel="prefetch" href="/assets/index.html-VjmEzQwX.js" as="script"><link rel="prefetch" href="/assets/index.html-BYrG5c3f.js" as="script"><link rel="prefetch" href="/assets/index.html-uS7RoDyV.js" as="script"><link rel="prefetch" href="/assets/index.html-BN0vM1Pt.js" as="script"><link rel="prefetch" href="/assets/index.html-DjKmAJab.js" as="script"><link rel="prefetch" href="/assets/index.html-IYajQsbY.js" as="script"><link rel="prefetch" href="/assets/index.html-qTcnEKJi.js" as="script"><link rel="prefetch" href="/assets/index.html-Dvwgh-6h.js" as="script"><link rel="prefetch" href="/assets/index.html-CaXrNX7n.js" as="script"><link rel="prefetch" href="/assets/index.html-By3qBjr0.js" as="script"><link rel="prefetch" href="/assets/index.html-Dtcya-gl.js" as="script"><link rel="prefetch" href="/assets/index.html-Ddv0VPyV.js" as="script"><link rel="prefetch" href="/assets/index.html-epXPV-w9.js" as="script"><link rel="prefetch" href="/assets/index.html-l25ZYotD.js" as="script"><link rel="prefetch" href="/assets/index.html-DxLfRlbF.js" as="script"><link rel="prefetch" href="/assets/index.html-6M7EH1g5.js" as="script"><link rel="prefetch" href="/assets/index.html-BEOrJwHr.js" as="script"><link rel="prefetch" href="/assets/index.html-CkSf3yev.js" as="script"><link rel="prefetch" href="/assets/index.html-C4DGOnAk.js" as="script"><link rel="prefetch" href="/assets/index.html-BMqlJl0N.js" as="script"><link rel="prefetch" href="/assets/index.html-WBYnS-vB.js" as="script"><link rel="prefetch" href="/assets/index.html-DdezCmRK.js" as="script"><link rel="prefetch" href="/assets/index.html-DXqzd4Mv.js" as="script"><link rel="prefetch" href="/assets/waline-meta-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/assets/component-C6SQ-eBi.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Lance</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/" aria-label="HOME"><img class="icon" src="/img/home.svg" alt aria-hidden no-view style="">HOME<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="基础知识"><!--[--><img class="icon" src="/img/computer.svg" alt aria-hidden no-view style="">基础知识<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" aria-label="操作系统"><img class="icon" src="/img/操作系统.svg" alt aria-hidden no-view style="">操作系统<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" aria-label="计算机网络"><img class="icon" src="/img/网络计算机.svg" alt aria-hidden no-view style="">计算机网络<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" aria-label="数据结构"><img class="icon" src="/img/数据结构.svg" alt aria-hidden no-view style="">数据结构<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%AE%97%E6%B3%95/" aria-label="算法"><img class="icon" src="/img/算法.svg" alt aria-hidden no-view style="">算法<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="后端"><!--[--><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">后端<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%90%8E%E7%AB%AF/Java/" aria-label="Java基础"><img class="icon" src="/img/java.svg" alt aria-hidden no-view style="">Java基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link active vp-link" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/" aria-label="数据库"><img class="icon" src="/img/数据库.svg" alt aria-hidden no-view style="">数据库<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%90%8E%E7%AB%AF/springboot/" aria-label="后端"><img class="icon" src="/img/SPRINGBOOT.svg" alt aria-hidden no-view style="">后端<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/" aria-label="微服务"><img class="icon" src="/img/SpringCloud.svg" alt aria-hidden no-view style="">微服务<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/" aria-label="ELK"><img class="icon" src="/img/Elastic.svg" alt aria-hidden no-view style="">ELK<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="工具"><!--[--><img class="icon" src="/img/tool.svg" alt aria-hidden no-view style="">工具<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%B7%A5%E5%85%B7/Markdown.html" aria-label="Markdown"><img class="icon" src="/img/markdown.svg" alt aria-hidden no-view style="">Markdown<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%B7%A5%E5%85%B7/latexMath.html" aria-label="Latex公式"><img class="icon" src="/img/latex.svg" alt aria-hidden no-view style="">Latex公式<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%B7%A5%E5%85%B7/Git.html" aria-label="Git"><img class="icon" src="/img/git.svg" alt aria-hidden no-view style="">Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E5%B7%A5%E5%85%B7/Docker.html" aria-label="Docker"><img class="icon" src="/img/docker.svg" alt aria-hidden no-view style="">Docker<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="项目"><!--[--><img class="icon" src="/img/项目.svg" alt aria-hidden no-view style="">项目<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E9%A1%B9%E7%9B%AE/skytakeout/" aria-label="苍穹外卖"><img class="icon" src="/img/外卖.svg" alt aria-hidden no-view style="">苍穹外卖<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E9%A1%B9%E7%9B%AE/hmall/" aria-label="黑马商城"><img class="icon" src="/img/商城.svg" alt aria-hidden no-view style="">黑马商城<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E9%A1%B9%E7%9B%AE/heimaLeadnews/" aria-label="黑马头条"><img class="icon" src="/img/头条.svg" alt aria-hidden no-view style="">黑马头条<!----></a></li><li class="vp-dropdown-item"><a class="route-link vp-link" href="/posts/%E9%A1%B9%E7%9B%AE/studyOnline/" aria-label="学成在线"><img class="icon" src="/img/教育.svg" alt aria-hidden no-view style="">学成在线<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/weiruyi" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><img class="icon" src="/img/java.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Java基础</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/" aria-label="JVM"><img class="icon" src="/img/JVM.svg" alt aria-hidden no-view style="">JVM<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/2-%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6.html" aria-label="字节码文件"><img class="icon" src="/img/JVM.svg" alt aria-hidden no-view style="">字节码文件<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/3-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.html" aria-label="类加载器"><img class="icon" src="/img/JVM.svg" alt aria-hidden no-view style="">类加载器<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/4_%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" aria-label="垃圾回收"><img class="icon" src="/img/JVM.svg" alt aria-hidden no-view style="">垃圾回收<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/10-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html" aria-label="分布式锁"><img class="icon" src="/img/lock.svg" alt aria-hidden no-view style="">分布式锁<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/20_nio.html" aria-label="NIO"><img class="icon" src="/img/java.svg" alt aria-hidden no-view style="">NIO<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/21_Netty%E5%9F%BA%E7%A1%80.html" aria-label="Netty基础"><!---->Netty基础<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/22_Netty%E8%BF%9B%E9%98%B6.html" aria-label="Netty进阶"><!---->Netty进阶<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/Java/30_%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.html" aria-label="Java反射和动态代理详解"><img class="icon" src="/img/JVM.svg" alt aria-hidden no-view style="">Java反射和动态代理详解<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><img class="icon" src="/img/数据库.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">数据库</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/" aria-label="SQL语句"><img class="icon" src="/img/SQL.svg" alt aria-hidden no-view style="">SQL语句<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/2_mysql%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5.html" aria-label="MySQL主从同步"><img class="icon" src="/img/mysql.svg" alt aria-hidden no-view style="">MySQL主从同步<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/3_%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html" aria-label="MySQL读写分离"><img class="icon" src="/img/mysql.svg" alt aria-hidden no-view style="">MySQL读写分离<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/4_canal.html" aria-label="Canal数据同步"><img class="icon" src="/img/数据同步.svg" alt aria-hidden no-view style="">Canal数据同步<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/10_MyBatis.html" aria-label="MyBatis"><img class="icon" src="/img/mybatis.svg" alt aria-hidden no-view style="">MyBatis<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/11_MyBatisPlus.html" aria-label="MyBatisPlus"><img class="icon" src="/img/mybatisplus.svg" alt aria-hidden no-view style="">MyBatisPlus<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/15_MySQL%E9%AB%98%E7%BA%A71.html" aria-label="MySQL高级一"><img class="icon" src="/img/mysql.svg" alt aria-hidden no-view style="">MySQL高级一<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/16_mysql%E9%AB%98%E7%BA%A72.html" aria-label="MySQL高级二"><img class="icon" src="/img/mysql.svg" alt aria-hidden no-view style="">MySQL高级二<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/20_redis.html" aria-label="Redis基础"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis基础<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/21_redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" aria-label="Redis数据结构"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis数据结构<!----></a></li><li><a class="route-link active vp-link vp-sidebar-link vp-sidebar-page active" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/22_redis%E5%8D%95%E6%9C%BA.html" aria-label="Redis单机"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis单机<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/23_redis%E5%A4%9A%E6%9C%BA.html" aria-label="Redis多机"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis多机<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/24_redis%E7%8B%AC%E7%AB%8B%E5%8A%9F%E8%83%BD.html" aria-label="Redis独立功能"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis独立功能<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><img class="icon" src="/img/SPRINGBOOT.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">后端</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/" aria-label="Spring"><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">Spring<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/IOC.html" aria-label="IOC"><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">IOC<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/aop.html" aria-label="AOP"><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">AOP<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/jwt.html" aria-label="JWT令牌以及登录验证"><img class="icon" src="/img/jwt.svg" alt aria-hidden no-view style="">JWT令牌以及登录验证<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/%E6%8B%A6%E6%88%AA%E5%99%A8%E8%BF%87%E6%BB%A4%E5%99%A8.html" aria-label="拦截器和过滤器"><img class="icon" src="/img/拦截器.svg" alt aria-hidden no-view style="">拦截器和过滤器<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/%E7%BC%93%E5%AD%98.html" aria-label="SpringCache缓存"><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">SpringCache缓存<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/SpringTask_7.html" aria-label="SpringTask"><img class="icon" src="/img/定时任务.svg" alt aria-hidden no-view style="">SpringTask<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/websocket_8.html" aria-label="WebSocket"><img class="icon" src="/img/WebSocket.svg" alt aria-hidden no-view style="">WebSocket<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/9_%E4%BA%8B%E5%8A%A1.html" aria-label="Spring事务"><img class="icon" src="/img/spring.svg" alt aria-hidden no-view style="">Spring事务<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/10_%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86.html" aria-label="SpringBoot自动装配原理"><img class="icon" src="/img/SPRINGBOOT.svg" alt aria-hidden no-view style="">SpringBoot自动装配原理<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/11_springsecurity.html" aria-label="SpringSecurity"><img class="icon" src="/img/spring-security.svg" alt aria-hidden no-view style="">SpringSecurity<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springboot/12_springsecurity2.html" aria-label="SpringSecurity进阶"><img class="icon" src="/img/spring-security.svg" alt aria-hidden no-view style="">SpringSecurity进阶<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><img class="icon" src="/img/SpringCloud.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">微服务</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/" aria-label="微服务"><img class="icon" src="/img/SpringCloud.svg" alt aria-hidden no-view style="">微服务<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8.html" aria-label="服务注册与远程调用"><img class="icon" src="/img/nacos.svg" alt aria-hidden no-view style="">服务注册与远程调用<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1_4.html" aria-label="统一网关路由"><img class="icon" src="/img/网关.svg" alt aria-hidden no-view style="">统一网关路由<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86_5.html" aria-label="配置管理"><img class="icon" src="/img/nacos.svg" alt aria-hidden no-view style="">配置管理<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/6_%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4.html" aria-label="服务保护"><img class="icon" src="/img/sentinel.svg" alt aria-hidden no-view style="">服务保护<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/7_%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html" aria-label="分布式事务"><img class="icon" src="/img/seata.svg" alt aria-hidden no-view style="">分布式事务<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/8_MQ%E5%9F%BA%E7%A1%80.html" aria-label="MQ基础"><img class="icon" src="/img/rabbitmq.svg" alt aria-hidden no-view style="">MQ基础<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/9_MQ%E9%AB%98%E7%BA%A7.html" aria-label="MQ高级"><img class="icon" src="/img/rabbitmq.svg" alt aria-hidden no-view style="">MQ高级<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/10_minio.html" aria-label="MinIO分布式文件系统"><img class="icon" src="/img/MinIO.svg" alt aria-hidden no-view style="">MinIO分布式文件系统<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/11_xxl-job.html" aria-label="XXL-JOB分布式任务调度"><img class="icon" src="/img/xxl-job.svg" alt aria-hidden no-view style="">XXL-JOB分布式任务调度<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/springcloud/12_kafka.html" aria-label="Kafka详解"><img class="icon" src="/img/Kafka.svg" alt aria-hidden no-view style="">Kafka详解<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><img class="icon" src="/img/Elastic.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">ELK</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/" aria-label="ELK"><img class="icon" src="/img/Elastic.svg" alt aria-hidden no-view style="">ELK<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/2_es%E5%9F%BA%E7%A1%80.html" aria-label="ElasticSearch基础"><img class="icon" src="/img/es.svg" alt aria-hidden no-view style="">ElasticSearch基础<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/3_esDSL.html" aria-label="ElasticSearch DSL"><img class="icon" src="/img/es.svg" alt aria-hidden no-view style="">ElasticSearch DSL<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/4_elasticSearch%E4%B8%8EMySQL%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.html" aria-label="ES与MySQL数据同步"><img class="icon" src="/img/mysql.svg" alt aria-hidden no-view style="">ES与MySQL数据同步<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/posts/%E5%90%8E%E7%AB%AF/elasticSearch/5_ES%E9%9B%86%E7%BE%A4.html" aria-label="ES集群"><img class="icon" src="/img/es.svg" alt aria-hidden no-view style="">ES集群<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis单机</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">RuyiWei</span></span><span property="author" content="RuyiWei"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-11-27T16:14:58.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/22_redis%E5%8D%95%E6%9C%BA.html" data-page-key="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/22_redis%E5%8D%95%E6%9C%BA.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7 clickable" role="navigation">数据库</span><!--]--><meta property="articleSection" content="数据库"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">redis</span><!--]--><meta property="keywords" content="redis"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#一、数据库">一、数据库</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、实现">1、实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、键空间">2、键空间</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3、过期回收">3、过期回收</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4、aof、rdb和复制功能对过期键的处理">4、AOF、RDB和复制功能对过期键的处理</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5、数据库通知">5、数据库通知</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#二、rdb持久化">二、RDB持久化</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、rdb文件的创建与载入">1、RDB文件的创建与载入</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、自动保存">2、自动保存</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3、rdb文件结构">3、RDB文件结构</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4、分析rdb文件">4、分析RDB文件</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#三、aof持久化">三、AOF持久化</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、实现-1">1、实现</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、aof重写">2、AOF重写</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#四、事件">四、事件</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、文件事件">1、文件事件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、时间事件">2、时间事件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3、事件的调度与执行">3、事件的调度与执行</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#五、客户端">五、客户端</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、通用属性">1、通用属性</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、创建与连接">2、创建与连接</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#六、服务器">六、服务器</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1、命令执行过程">1、命令执行过程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2、命令执行过程">2、命令执行过程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3、servercron函数">3、serverCron函数</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4、初始化服务器">4、初始化服务器</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><!--more--><h1 id="redis单机" tabindex="-1"><a class="header-anchor" href="#redis单机"><span>Redis单机</span></a></h1><h2 id="一、数据库" tabindex="-1"><a class="header-anchor" href="#一、数据库"><span>一、数据库</span></a></h2><h3 id="_1、实现" tabindex="-1"><a class="header-anchor" href="#_1、实现"><span>1、实现</span></a></h3><p>Redis服务器将所有数据库都保存在服务器状态redis.h/redisServer结构的db数组中，db数组的每个项都是一个redis.h/redisDb结构，每个redisDb结构代表一个数据库。数组长度（数据库数量）由dbnum控制，默认有16个，通过<code>SELECT</code>命令切换数据库。</p><p>RedisClient结构中的db属性指向当前所使用的数据库，SELECT命令原理即修改该指针。</p><!----><h3 id="_2、键空间" tabindex="-1"><a class="header-anchor" href="#_2、键空间"><span>2、键空间</span></a></h3><p>Redis是一个键值对K-V数据库服务器，服务器中的每个数据库都由一个redis.h/redisDb结构表示，其中，redisDb结构的dict字典保存了数据库中的所有键值对，这个字典称为键空间（key space）。所有针对数据库中数据的操作本质上都是对键空间字典的操作，同时也会进行一些维护：</p><ul><li>读写键时，会记录键空间命中/不命中次数</li><li>更新键的LRU时间</li><li>删除读取到的过期键</li><li>watch命令监视某个键时，修改后标记dirty，告知事务程序</li><li>根据配置发送相应的通知</li></ul><h3 id="_3、过期回收" tabindex="-1"><a class="header-anchor" href="#_3、过期回收"><span>3、过期回收</span></a></h3><ul><li><code>Expire | pExpire | ExpireAt | pExpireAt &lt;key&gt; &lt;time&gt;</code>指定键的过期时间，单位s，p开头的命令单位ms <ul><li>实现上前三个最终都调用pExpireAt实现</li><li>底层在redisDb结构的expires字典保存所有键的过期时间，称过期字典。其键指向某个键的对象，其值是long long类型整数，表示ms精度的Unix时间戳</li></ul></li><li><code>TTL | pTTL &lt;key&gt;</code>返回剩余生存时间，即查询键的过期时间和当前时间之差</li><li><code>Persist &lt;key&gt;</code>移除某个键的过期时间，即删除过期字典的某个键值对</li></ul><!----><ul><li>不同的回收策略： <ul><li>定时删除：创建定时器自动删除。内存友好，但消耗CPU时间</li><li>惰性删除：访问键时才执行判断删除。CPU友好，但容易造成部分键长时间无法删除</li><li>定期删除：每隔一段时间执行一次过期删除。上面两种方法的综合，但难以确定执行的频率和时长</li></ul></li><li>Redis的回收策略：惰性删除 + 定期删除 <ul><li>惰性删除由db.c/expireIfNeeded函数实现。算法同上</li><li>定期删除由redis.c/activeExpireCycle函数实现。在规定时间内，分多次遍历服务器中的各个数据库，从expires字典中随机检查一部分键的过期时间，并删除过期键。</li></ul></li></ul><h3 id="_4、aof、rdb和复制功能对过期键的处理" tabindex="-1"><a class="header-anchor" href="#_4、aof、rdb和复制功能对过期键的处理"><span>4、AOF、RDB和复制功能对过期键的处理</span></a></h3><ul><li><p>RDB持久化：</p><ul><li>保存时，过期键不会写入新创建的RDB文件；</li><li>载入时，如果是主服务器模式，过期键不会加载</li><li>载入时，如果是从服务器模式，过期键依然会加载，由主从同步保证数据一致性</li></ul></li><li><p>AOF持久化:</p><ul><li>保存时没有任何影响。但过期删除后，会向AOF文件追加DEL命令，显式记录该键已删除</li><li>重写时过期键不会写入</li></ul></li><li><p>复制功能：由主服务器控制从服务器同意删除过期键，保证主从服务器的数据一致性</p><ul><li>主服务器在删除一个过期键之后，会显式地向所有从服务器发送一个DEL命令，告知从服务器删除这个过期键</li><li>从服务器执行读命令时，即使碰到过期键也不会删除，继续像处理未过期键一样来处理</li><li>从服务器只有在接到主服务器发来的DEL命令之后，才会删除过期键</li></ul></li></ul><h3 id="_5、数据库通知" tabindex="-1"><a class="header-anchor" href="#_5、数据库通知"><span>5、数据库通知</span></a></h3><ul><li>键空间通知：关于&quot;某个键执行了什么命令&quot;的通知 <code>SUBSCRIBE __keyspace@0__:&lt;key&gt;</code></li><li>键事件通知：关于&quot;某个命令被什么键执行&quot;的通知 <code>SUBSCRIBE __keyevent@0__:&lt;opt&gt;</code></li><li>服务器配置的notify-keyspace-events选项决定了服务器所发送通知的类型</li><li>底层由<code>notify.c/notifyKeyspaceEvent(type, event, key, bdid)</code>函数实现</li></ul><h2 id="二、rdb持久化" tabindex="-1"><a class="header-anchor" href="#二、rdb持久化"><span>二、RDB持久化</span></a></h2><p>Redis提供RDB持久化功能，将内存数据保存到磁盘，生成经过压缩的二进制文件，避免数据丢失。</p><h3 id="_1、rdb文件的创建与载入" tabindex="-1"><a class="header-anchor" href="#_1、rdb文件的创建与载入"><span>1、RDB文件的创建与载入</span></a></h3><ul><li><p>创建：</p><ul><li>SAVE：阻塞服务器进程，由主线程执行保存。 <ul><li>执行期间，所有客户端命令都会被拒绝</li></ul></li><li>BGSAVE：创建子进程执行保存 <ul><li>执行期间，新的SAVE、BGSAVE命令会被拒绝，防止竞争</li><li>执行期间，新的BGREWRITEAOF命令延迟到保存任务结束执行</li><li>出于性能考虑，BGREWRITEAOF命令执行期间，新的BGSAVE命令会被拒绝</li></ul></li></ul></li><li><p>载入：</p><ul><li>服务器启动时自动载入，但优先级低于AOF文件</li><li>载入期间，服务器一直处于阻塞状态</li></ul></li></ul><h3 id="_2、自动保存" tabindex="-1"><a class="header-anchor" href="#_2、自动保存"><span>2、自动保存</span></a></h3><p>serverCron服务器周期性函数每隔100ms执行一次维护，其中包括RDB保存。触发的条件由配置中的save选项定义，程序会遍历并检查saveparams数组中的所有保存条件,只要任何一个满足，将自动执行BGSAVE命令。</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token comment"># save &lt;time&gt; &lt;changes&gt;</span>
<span class="token comment"># 服务器在900秒之内，对数据库进行了至少1次修改。</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">900 1 </span>
<span class="token comment"># 服务器在300秒之内，对数据库进行了至少10次修改。</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">300 10</span>
<span class="token comment">#服务器在60秒之内，对数据库进行了至少10000次修改。</span>
<span class="token key attr-name">save</span> <span class="token value attr-value">60 10000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在实现上：redisServer结构的</p><ul><li>saveparams数组保存触发条件</li><li>dirty计数器记录上次成功执行SAVE/BGSAVE后，所有数据库修改的总次数（每个键算一次）</li><li>lastsave属性记录上次成功执行SAVE/BGSAVE的时间</li></ul><h3 id="_3、rdb文件结构" tabindex="-1"><a class="header-anchor" href="#_3、rdb文件结构"><span>3、RDB文件结构</span></a></h3><p><strong>整体结构:</strong></p><!----><ul><li>REDIS：RDB文件常量标志，占5Byte</li><li>db_version: RDB文件版本号，占4Byte</li><li>databases: 包含所有数据库数据，长度由数据库数据决定</li><li>EOF：末尾常量标记，占1ByteREDIS_ENCODING_</li><li>check_sum: 前4个字段的校验和，占8byte长的无符号整数</li></ul><p><strong>database部分:</strong></p><!----><ul><li>SELECTDB: 标记下一个将读入数据库编号，占1Byte</li><li>db_number: 数据库编号，占1/2/5Byte。读入后调用SELECT切换数据库</li><li>key_value_pairs: 所有数据库的键值对数据，以及可选的过期时间</li></ul><p><strong>key_value_pairs部分:</strong></p><!----><ul><li>EXPIRETIME_MS: 可选，标记下一个将读入以ms为单位的过期时间，占1Byte</li><li>ms: 可选，UNIX时间戳，8Byte有符号整数</li><li>TYPE: 值对象类型/底层编码</li><li>key: 字符串对象表示的键</li><li>value: 值对象</li></ul><p><strong>value部分:</strong></p><!----><ul><li>字符串对象： <ul><li>如果是<code>REDIS_ENCODING_INT</code>，则以 <code>ENCODING+integer</code> 的形式保存，ENCODING标记占8/16/32位长</li><li>如果是<code>REDIS_ENCODING_RAW</code>，则保存的是字符串 <ul><li>对于长度<mjx-container class="MathJax" jax="SVG" style="position:relative;"><svg style="vertical-align:-0.464ex;" xmlns="http://www.w3.org/2000/svg" width="11.108ex" height="2.009ex" role="img" focusable="false" viewBox="0 -683 4909.8 888" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><g data-mml-node="text"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="text" transform="translate(778,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g></g><g data-mml-node="mn" transform="translate(1833.8,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(2833.8,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(3592.8,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4082.8,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(4443.8,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&lt;=</mo><mn>20</mn><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi></math></mjx-assistive-mml></mjx-container>的串，以 <code>len+string</code> 的形式保存</li><li>对于长度<mjx-container class="MathJax" jax="SVG" style="position:relative;"><svg style="vertical-align:-0.464ex;" xmlns="http://www.w3.org/2000/svg" width="9.348ex" height="2.009ex" role="img" focusable="false" viewBox="0 -683 4131.8 888" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path></g><g data-mml-node="mn" transform="translate(1055.8,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(2055.8,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2814.8,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3304.8,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3665.8,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo><mn>20</mn><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi></math></mjx-assistive-mml></mjx-container>的串，以 <code>REDIS_RDB_ENC_LZF+compressed_len+origin_len+compressed_string </code>的形式保存，其中REDIS_RDB_ENC_LZF是LZF压缩算法标记</li></ul></li></ul></li><li>列表对象： <ul><li>TYPE为<code>REDIS_RDB_TYPE_LIST</code>，以<code>list_length+itemN+...</code>的形式保存</li><li>每个item按字符串对象保存</li></ul></li><li>集合对象： <ul><li>TYPE为<code>REDIS_RDB_TYPE_SET</code>，以 <code>set_size+elemN+... </code>的形式保存</li><li>每个elem按字符串对象保存</li></ul></li><li>哈希表对象： <ul><li>TYPE为<code>REDIS_RDB_TYPE_HASH</code>，以 <code>hash_size+keyN+valueN+... </code>的形式保存</li><li>每个键、值按字符串对象相邻保存</li></ul></li><li>有序集合对象： <ul><li>TYPE为<code>REDIS_RDB_TYPE_ZSET</code>，以 <code>sorted_set_size+memberN+scoreN+... </code>的形式保存</li><li>每个成员、分值按字符串对象相邻保存</li><li>分值由double转为字符串，载入时自动转换</li></ul></li><li>INTSET编码和集合： <ul><li>TYPE为<code>REDIS_RDB_TYPE_SET_INTSET</code>，将整数转为字符串，按字符串对象保存</li></ul></li><li>ZIPLIST编码的列表、哈希表、有序集合： <ul><li>TYPE为<code>REDIS_RDB_TYPE_LIST|HASH|ZSET_ZIPLIST</code>，将压缩列表类型的value转为字符串对象</li></ul></li></ul><h3 id="_4、分析rdb文件" tabindex="-1"><a class="header-anchor" href="#_4、分析rdb文件"><span>4、分析RDB文件</span></a></h3><p><code>od -cx dump.rdb</code> 以ASCII和16进制打开RDB文件 <code>redis-check-dump</code> 工具</p><h2 id="三、aof持久化" tabindex="-1"><a class="header-anchor" href="#三、aof持久化"><span>三、AOF持久化</span></a></h2><p>除了RDB持久化，Redis还提供AOF（Append Only File），通过保存所执行的写命令实现持久化。</p><h3 id="_1、实现-1" tabindex="-1"><a class="header-anchor" href="#_1、实现-1"><span>1、实现</span></a></h3><ul><li>命令追加：服务器每执行完一个写命令，以协议格式将被执行的命令追加到redisServer的<code>aof_buf</code>缓冲区</li><li>写入与同步： <ul><li>Redis服务器进程本质上是一个事件循环，其中文件事件负责处理客户端请求，时间事件负责执行<code>serverCron</code>这样定时运行的函数 <ul><li>每结束一个事件循环，会调用<code>flushAppendOnlyFile</code>函数，决定是否将<code>aof_buf</code>写入AOF文件中</li></ul></li><li>同步行为由<code>appendfsync</code>选项值决定： <ul><li><code>always</code>：每次有数据修改发生时都会写入AOF文件。效率最慢，安全性最高</li><li><code>everysec</code>：<strong>默认</strong>，每秒钟同步一次，显式地将多个写命令同步到硬盘。效率适中</li><li><code>no</code>：由 OS 决定何时进行同步。效率最高安全性最差</li></ul></li></ul></li><li>载入数据：创建不带网络连接的伪客户端（上下文），读取、分析并执行AOF文件中的每一条命令。</li></ul><h3 id="_2、aof重写" tabindex="-1"><a class="header-anchor" href="#_2、aof重写"><span>2、AOF重写</span></a></h3><p>为了避免大量写命令造成AOF文件体积过大，以及还原时间过长，需要用BGREWRITEAOF命令对AOF文件重写。</p><ul><li>本质上并不读取旧AOF文件，而是创建一个新文件，直接读取数据库状态，然后将数据写入新AOF文件</li><li>为了避免客户端输入缓冲区溢出，处理列表,哈希表,集合,有序集合这四种可能会带有多个键,对于超过<code>REDIS_AOF_REWRITE_ITEMS_PER_CMD</code>数量的键，分多条命令写入</li><li>Redis使用子进程执行重写 <ul><li>优点：不阻塞服务器进程，且子进程带有服务器进程的数据副本，避免用锁保证数据安全</li><li>问题：重写过程中与服务器进程的数据不一致性。</li><li>解决方案： <ul><li>子进程执行重写的过程中，新的客户端命令不仅要追加到aof_buf，还要追加到<code>aof_rewrite_buf</code></li><li>子进程完成重写后，向服务器进程发送信号。由主进程将<code>aof_rewrite_buf</code>写入AOF文件，保证数据一致性</li><li>最后以原子操作，将新AOF文件改名覆盖旧AOF文件</li></ul></li></ul></li></ul><h2 id="四、事件" tabindex="-1"><a class="header-anchor" href="#四、事件"><span>四、事件</span></a></h2><p>Redis服务器是基于Reactor模式的事件驱动程序，主要处理两类事件：</p><ul><li>文件事件：服务器与客户端通信，对套接字操作的抽象</li><li>时间事件：定时操作的抽象</li></ul><h3 id="_1、文件事件" tabindex="-1"><a class="header-anchor" href="#_1、文件事件"><span>1、文件事件</span></a></h3><!----><ul><li>套接字：文件事件的抽象，每当一个套接字准备好执行连接应答、写入、读取、关闭等操作时，就会产生一个文件事件 <ul><li>复用程序可以监听套接字的<code>AE_READABLE</code> | <code>AE_WRITABLE</code>事件</li><li>也可以同时监听<code>AE_READABLE</code>、<code>AE_WRITABLE</code>，如果同时产生事件，服务器将先读后写</li></ul></li><li>I/O多路复用程序：负责监听多个套接字，并向文件事件分派器传送那些产生了事件的套接字 <ul><li>所有产生事件的套接字都会放到一个队列里，然后以有序、同步、每次一个套接字的方式传送套接字</li><li>当上一个套接字产生的事件被处理完毕之后，才会继续传送下一个套接字</li><li>实现上通过包装常见的I/O多路复用库，如select, epoll, evport, kqueue等，且提供相同的API，编译时自动选择性能最高的函数库</li></ul></li><li>文件事件分派器：接收I/O多路复用程序传来的套接字，并根据套接字产生的事件的类型调用相应的事件处理器</li><li>事件处理器：与不同任务的套接字关联的一个个函数，定义了某个事件发生时服务器应该执行的动作。常用的有三类： <ul><li>连接应答处理器：acceptTcpHandler函数，用于对连接服务器监听套接字的客户端进行应答</li><li>命令请求处理器：readQueryFromClient函数，负责从套接字中读入客户端发送的命令请求内容</li><li>命令回复处理器：sendReplyToClient函数，负责将服务器执行命令后得到的回复通过套接字返回给客户端</li></ul></li></ul><!----><h3 id="_2、时间事件" tabindex="-1"><a class="header-anchor" href="#_2、时间事件"><span>2、时间事件</span></a></h3><p>一个时间事件主要有三个属性组成：</p><ul><li>id：服务器为时间事件创建的全局唯一ID。ID从小到大递增</li><li>when：毫秒精度的UNIX时间戳，记录了时间事件的到达时间</li><li>timeProc：时间事件处理器，一个函数。当时间事件到达时，服务器就会调用相应的处理器来处理事件</li></ul><p>Redis的时间事件分定时事件和周期性事件两类，目前仅使用周期性事件。类型取决于处理器的返回值：</p><ul><li>AE_NOMORE：定时事件，到达一次后就删除</li><li>非AE_NOMORE 周期性事件，根据返回值对事件的when属性更新，继续运行</li></ul><p>实现上，服务器将所有时间事件放在一个无序链表（不按when属性排序，按id）中，每当时间事件执行器运行时，遍历整个链表，查找已到达的事件并调用相应的处理器。不过目前Redis仅有serverCron一个时间事件，因此实际上该链表仅一个节点。serverCron函数的工作包括：</p><ul><li>更新服务器的各类统计信息，比如时间、内存占用、数据库占用情况等。</li><li>清理数据库中的过期键值对。</li><li>关闭和清理连接失效的客户端。</li><li>尝试进行AOF或RDB持久化操作。</li><li>如果服务器是主服务器，那么对从服务器进行定期同步。</li><li>如果处于集群模式，对集群进行定期同步和连接测试。</li></ul><h3 id="_3、事件的调度与执行" tabindex="-1"><a class="header-anchor" href="#_3、事件的调度与执行"><span>3、事件的调度与执行</span></a></h3><!----><ul><li>等待文件事件产生调用的是aeApiPoll，阻塞时间由到达时间最接近当前时间的时间事件决定，避免对时间事件频繁轮询也避免阻塞时间过长</li><li>文件事件是随机出现的，如果处理完一次文件事件，没有时间事件到达，将再次等待处理文件事件</li><li>对事件的处理都是同步、有序、原子的，不会中断也不会抢占。但都会尽量减少阻塞时间，并在需要时让出执行权</li><li>时间事件在文件事件之后，且不会抢占，因此时间事件的实际执行通常比设定时间稍晚一些</li></ul><h2 id="五、客户端" tabindex="-1"><a class="header-anchor" href="#五、客户端"><span>五、客户端</span></a></h2><p>Redis是一对多的服务器程序，通过I/O多路复用实现单线程单进程处理所有客户端的命令请求。redisServer中的clients指针指向了保存所有客户端状态的redisClient结构数组。</p><h3 id="_1、通用属性" tabindex="-1"><a class="header-anchor" href="#_1、通用属性"><span>1、通用属性</span></a></h3><ul><li>fd: 客户端正在使用的套接字描述符 <ul><li>值 -1 表示伪客户端，包括AOF载入和Lua脚本两种场景</li><li>大于-1的整数即普通客户端</li></ul></li><li>name: 通过<code>CLIENT name xxx</code>设置，让客户端身份更清晰</li><li>flags：各种状态信息标志位</li><li>querybuf：输入缓冲区，根据输入动态调节，最大1GB</li><li>argv、argc：命令参数和数量</li><li>cmd：命令函数，redisCommand类型</li><li>buf、bufpos：固定大小的输出缓冲区和已使用大小，保存长度较小的回复</li><li>reply：可变大小的输出缓冲区，链表结构，保存长度较大的回复</li><li>authenticated：身份认证，0未通过，1通过。未通过时除AUTH命令外都会被拒绝执行</li><li>ctime：客户端创建时间</li><li>lastinteraction：上一次交互时间</li><li>obuf_soft_limit_reached_time：输出缓冲区第一次到达软性限制的时间 <ul><li>服务器使用两种模式限制输出缓冲区大小，一种硬限制，超过即关闭客户端</li><li>另一种是软限制，超过后继续监测，如果持续一段时间（配合readched_time）一直超过则关闭。</li></ul></li></ul><h3 id="_2、创建与连接" tabindex="-1"><a class="header-anchor" href="#_2、创建与连接"><span>2、创建与连接</span></a></h3><ul><li>普通客户端： <ul><li>创建：通过网络连接，创建相应的redisClient，加入服务器状态的clients链表末尾</li><li>关闭：进程结束、请求不符合协议、KILL、timeout、I/O缓冲区溢出...</li><li>注意:为了避免客户端回复过大,占用过多服务器资源,服务器会时刻检查客户端的输出缓冲区大小,并在缓冲区的大小超出范围时执行相应的限制操作 <ul><li>硬性限制:如果缓冲区大小超过硬性限制所设置的大小,会立刻关闭客户端</li><li>软性限制:只有一直超出软性限制并且持续时间超出服务器设置的时长才会关闭客户端,如果缓冲区大小在指定时间内不再超出软性限制就不会关闭客户端</li></ul></li></ul></li><li>Lua伪客户端：服务器初始化时创建负责执行Lua脚本的伪客户端，关联在redisServer/lua_client属性中，直到服务器销毁时才会关闭。</li><li>AOF伪客户端：服务器载入AOF文件时，会创建用于执行AOF文件的伪客户端，载入完成后关闭。</li></ul><h2 id="六、服务器" tabindex="-1"><a class="header-anchor" href="#六、服务器"><span>六、服务器</span></a></h2><h3 id="_1、命令执行过程" tabindex="-1"><a class="header-anchor" href="#_1、命令执行过程"><span>1、命令执行过程</span></a></h3><ul><li>发送命令请求：用户键入命令请求，客户端将其转换成协议格式，然后通过连接套接字发送给服务器</li><li>读取命令请求： <ul><li>服务器读取套接字中的请求，保存到redisClient的输入缓冲区</li><li>分析缓冲区内的请求，提取命令参数及个数，保存到argv、argc</li><li>调用命令执行器，执行指定命令</li></ul></li><li>发送命令回复： <ul><li>命令实现函数将回复保存在redisClient的输出缓冲区</li><li>服务器通过命令回复处理器，将回复发送给客户端，并清空缓冲区</li></ul></li><li>接收命令回复：客户端接收回复并转换协议，打印出结果</li></ul><h3 id="_2、命令执行过程" tabindex="-1"><a class="header-anchor" href="#_2、命令执行过程"><span>2、命令执行过程</span></a></h3><p>根据redisClient的argv[0]在命令表中查找命令实现，即redisCommand结构，记录至cmd属性。主要属性有：</p><ul><li>name, proc实现函数, arity参数个数, sflags标记位, calls执行次数, milliseconds执行时长...</li></ul><!----><ul><li>执行预备操作：检查cmd非NULL，检查命令参数，身份验证，内存占用，持久化/订阅/Lua/监视器等检查工作</li><li>调用命令实现函数： <ul><li>调用redisClient-&gt;cmd-&gt;proc(client)</li><li>执行结果保存至输出缓冲区（buf/reply）</li><li>为客户端套接字关联回复处理器</li></ul></li><li>执行后续工作： <ul><li>跟新慢查询日志</li><li>更新redisClient相关属性</li><li>AOF同步</li><li>主从同步</li></ul></li></ul><h3 id="_3、servercron函数" tabindex="-1"><a class="header-anchor" href="#_3、servercron函数"><span>3、serverCron函数</span></a></h3><ol><li>更新服务器时间缓存，redisServer/unixtime、mstime <ul><li>serverCron每100ms执行一次，因此时间精度不高</li><li>仅用于对时间精度要求不高的功能，如打印日志、更新LRU时钟等</li><li>而需要高精度时间的任务，如设置过期时间、添加慢查询日志等，仍然执行系统调用获取准确时间</li></ul></li><li>更新LRU时钟：对象最后一次被访问时间，估算值</li><li>更新服务器每秒执行命令次数：INFO status 命令的 instantaneous_ops_per_sec 属性，实现上是采样平均得到的估算值</li><li>更新服务器内存峰值记录：redisServer/stat_peak_memory</li><li>处理SIGTERM结束服务器信号,关闭之前会进行RDB持久化</li><li>管理客户端资源：释放超时的客户端连接、重置溢出的客户端输入缓冲区</li><li>管理数据库资源：删除过期键、收缩字典</li><li>执行被延迟的BGREWRITEAOF</li><li>检查持久化操作的运行状态：redisServer/rdb_child_pid, aof_child_pid记录执行持久化的子进程</li></ol><!----><ol start="11"><li><p>同步AOF文件</p></li><li><p>关闭输出缓冲区溢出的客户端</p></li><li><p>增加cronloops计数器，记录serverCron执行次数</p></li></ol><h3 id="_4、初始化服务器" tabindex="-1"><a class="header-anchor" href="#_4、初始化服务器"><span>4、初始化服务器</span></a></h3><ul><li>初始化服务器状态结构：initServerConfig函数 <ul><li>设置服务器运行id、频率、配置文件路径、架构、端口、持久化条件，初始化LRU时钟，并创建命令表</li></ul></li><li>载入配置选项：通过给定配置参数/配置文件，修改服务器的默认配置</li><li>初始化服务器数据结构：initServer函数 <ul><li>server.clients: redisClient数组</li><li>server.db: 数据库结构数组</li><li>server.pubsub_channels/patterns: 保存频道订阅信息的字典、保存模式订阅信息的链表</li><li>server.lua: 执行Lua脚本的Lua环境</li><li>server.slowlog: 保存慢查询日志的结构</li><li>其它操作：设置进程信号处理器、创建共享对象、打开监听端口、创建时间事件、AOF持久化、初始化后台I/O</li></ul></li><li>还原数据库状态：如果启用AOF，则用AOF文件还原，否则使用RDB文件</li><li>执行事件循环：可以开始接收客户端连接和请求</li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="vp-link vp-external-link-icon vp-meta-label" href="https://github.com/weiruyi/edit/main/src/posts/后端/数据库/22_redis单机.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1581778251@qq.com">weiruyi</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link vp-link prev" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/21_redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" aria-label="Redis数据结构"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><img class="icon" src="/img/redis.svg" alt aria-hidden no-view style="">Redis数据结构</div></a><a class="route-link vp-link next" href="/posts/%E5%90%8E%E7%AB%AF/%E6%95%B0%E6%8D%AE%E5%BA%93/23_redis%E5%A4%9A%E6%9C%BA.html" aria-label="Redis多机"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Redis多机<img class="icon" src="/img/redis.svg" alt aria-hidden no-view style=""></div></a></nav><div id="vp-comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">邮箱</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">网址</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="表情" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="预览"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if-->  字</div><button type="button" class="wl-btn">登录</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> 评论</div><ul class="wl-sort"><!--[--><li class="active">按正序</li><li class="">按倒序</li><li class="">按热度</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v3.2.0</div></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2024 RuyiWei </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-_Le9TIJB.js" defer></script>
  </body>
</html>
